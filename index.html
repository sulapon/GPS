<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPS è¨ˆç®—å™¨</title>
    <style>
        /* æ¿ƒç¸® CSS æ¨£å¼ */
        body { font-family: sans-serif; margin: 0 5px; background-color: #f4f7f6; color: #333; }
        .c { max-width: 550px; margin: 3px auto; background: white; padding: 8px; border-radius: 8px; box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1); }
        h1 { text-align: center; color: #007bff; margin-bottom: 3px; border-bottom: 1px solid #007bff; padding-bottom: 2px; font-size: 18px; }
        .tip { text-align: center; color: #6a0dad !important; font-size: 13px !important; margin: 0 0 3px 0; font-weight: bold; }
        .ig { margin-bottom: 3px; padding: 4px; border: 1px solid #ddd; border-radius: 4px; background-color: #fafafa; }
        .ig > label { display: flex; align-items: center; justify-content: space-between; margin-bottom: 3px; font-weight: bold; color: #333; font-size: 13px; }
        
        .cg { border: 1px solid #eee; padding: 3px; margin-bottom: 3px; border-radius: 4px; }
        .cl { font-weight: bold; color: #555; display: block; margin-bottom: 2px; font-size: 12px; }

        /* è¼¸å…¥æ¡†é€šç”¨æ¨£å¼ */
        input[type="number"], input[type="text"] { 
            padding: 3px; border: 1px solid #ccc; border-radius: 3px; box-sizing: border-box; font-size: 12px; margin-right: 4px; 
        }

        /* åé€²åˆ¶è¼¸å…¥è¡Œ */
        .ddr { display: flex; align-items: center; margin-bottom: 2px; }
        .ddr input { flex-grow: 1; }
        .ddr span { color: #666; font-size: 11px; margin-right: 4px; flex-shrink: 0; }
        
        /* DMS è¼¸å…¥è¡Œ */
        .dmsr { display: flex; align-items: center; justify-content: space-between; }
        .dmsf { display: flex; align-items: center; flex: 1; }
        .dmsr input { text-align: center; margin-right: 2px; }
        #latA_deg, #lonA_deg, #latB_deg, #lonB_deg { width: 40px; }
        #latA_min, #lonA_min, #latB_min, #lonB_min { width: 30px; }
        #latA_sec, #lonA_sec, #latB_sec, #lonB_sec { width: 50px; }
        .dmsr span { color: #666; font-size: 11px; margin-right: 4px; flex-shrink: 0; }

        /* é«˜åº¦è¡Œ */
        .er { display: flex; align-items: center; margin-top: 3px; padding-top: 3px; border-top: 1px dashed #ddd; }
        .er input { max-width: 120px; }
        .er label, .er span { font-size: 12px; margin-right: 4px; flex-shrink: 0; }

        /* åœ°åè¼¸å…¥è¡Œ */
        .lnr { display: flex; align-items: center; margin-bottom: 5px; }
        .lnr input { max-width: 70px; }
        .lnr span { color: #666; font-size: 12px; flex-shrink: 0; }

        /* æ¸…é™¤æŒ‰éˆ• */
        .cb { background: none; border: none; color: #dc3545; font-size: 13px; cursor: pointer; padding: 2px 5px; line-height: 1; margin-left: auto; }

        /* è¨ˆç®—æŒ‰éˆ• */
        #calcBtn { width: 100%; padding: 7px; background-color: #28a745; color: white; border: none; border-radius: 4px; font-size: 14px; cursor: pointer; margin-top: 4px; }
        #calcBtn:hover { background-color: #218838; }

        /* çµæœé¡¯ç¤º */
        #res { margin-top: 4px; padding: 7px; border: 2px solid #007bff; border-radius: 4px; background-color: #e9f7ff; font-size: 13px; font-weight: bold; text-align: left; }
        #res p { margin: 2px 0; } 
        #res hr { border: 0; border-top: 1px solid #ddd; margin: 2px 0; }

        /* è·é›¢æ•¸å€¼ - å¼·åˆ¶è—è‰² */
        .v-dist { 
            color: #007bff !important; 
        } 
        
        /* æ–¹ä½è§’æ•¸å€¼ - ä¿æŒæ·±æ¾„è‰² */
        .v-bearing {
            color: #008B8B !important; 
        }

        /* ä¿¯ä»°è§’é¡è‰² */
        .rp { color: #9c27b0; } 
        .rpn { font-size: 11px !important; color: #6c757d; margin-left: 8px; margin-top: 0; margin-bottom: 2px !important; }
    </style>
</head>
<body>

<div class="c">
    <h1>ğŸŒ GPS è·é›¢ã€æ–¹ä½è§’èˆ‡ä¿¯ä»°è§’è¨ˆç®—å™¨</h1>
    <p class="tip">è€ƒæ…®åœ°çƒæ›²ç‡èˆ‡é«˜åº¦å·®</p>

    <div class="ig">
        <label>ğŸ“ åœ°é» A åº§æ¨™
            <div class="lnr">
                <input type="text" id="nameA" placeholder="æœ€å¤š5å­—" maxlength="5">
                <span>(è¼¸å…¥åœ°å)</span>
            </div>
        </label>
        
        <div class="cg">
            <span class="cl">ç·¯åº¦ (Latitude)</span>
            <div class="ddr">
                <input type="number" id="latA" placeholder="æ•¸å€¼" step="any" oninput="dToDMS('latA')">
                <span>åº¦åé€²åˆ¶</span>
                <button class="cb" onclick="clearCoord('latA')">âœ–</button>
            </div>
            <div class="dmsr">
                <div class="dmsf"><input type="number" id="latA_deg" placeholder="åº¦" oninput="dmsToD('latA')"><span>åº¦</span></div>
                <div class="dmsf"><input type="number" id="latA_min" placeholder="åˆ†" oninput="dmsToD('latA')"><span>åˆ†</span></div>
                <div class="dmsf"><input type="number" id="latA_sec" placeholder="ç§’" step="0.01" oninput="dmsToD('latA')"><span>ç§’</span></div>
            </div>
        </div>
        
        <div class="cg">
            <span class="cl">ç¶“åº¦ (Longitude)</span>
            <div class="ddr">
                <input type="number" id="lonA" placeholder="æ•¸å€¼" step="any" oninput="dToDMS('lonA')">
                <span>åº¦åé€²åˆ¶</span>
                <button class="cb" onclick="clearCoord('lonA')">âœ–</button>
            </div>
            <div class="dmsr">
                <div class="dmsf"><input type="number" id="lonA_deg" placeholder="åº¦" oninput="dmsToD('lonA')"><span>åº¦</span></div>
                <div class="dmsf"><input type="number" id="lonA_min" placeholder="åˆ†" oninput="dmsToD('lonA')"><span>åˆ†</span></div>
                <div class="dmsf"><input type="number" id="lonA_sec" placeholder="ç§’" step="0.01" oninput="dmsToD('lonA')"><span>ç§’</span></div>
            </div>
        </div>
        
        <div class="er">
            <label for="eleA">é«˜åº¦ (Elevation)</label>
            <input type="number" id="eleA" placeholder="ç±³ (m)" step="0.01">
            <span>å…¬å°º (m)</span>
        </div>
    </div>

    <div class="ig">
        <label>ğŸ¯ åœ°é» B åº§æ¨™
            <div class="lnr">
                <input type="text" id="nameB" placeholder="æœ€å¤š5å­—" maxlength="5">
                <span>(è¼¸å…¥åœ°å)</span>
            </div>
        </label>
        
        <div class="cg">
            <span class="cl">ç·¯åº¦ (Latitude)</span>
            <div class="ddr">
                <input type="number" id="latB" placeholder="æ•¸å€¼" step="any" oninput="dToDMS('latB')">
                <span>åº¦åé€²åˆ¶</span>
                <button class="cb" onclick="clearCoord('latB')">âœ–</button>
            </div>
            <div class="dmsr">
                <div class="dmsf"><input type="number" id="latB_deg" placeholder="åº¦" oninput="dmsToD('latB')"><span>åº¦</span></div>
                <div class="dmsf"><input type="number" id="latB_min" placeholder="åˆ†" oninput="dmsToD('latB')"><span>åˆ†</span></div>
                <div class="dmsf"><input type="number" id="latB_sec" placeholder="ç§’" step="0.01" oninput="dmsToD('latB')"><span>ç§’</span></div>
            </div>
        </div>
        
        <div class="cg">
            <span class="cl">ç¶“åº¦ (Longitude)</span>
            <div class="ddr">
                <input type="number" id="lonB" placeholder="æ•¸å€¼" step="any" oninput="dToDMS('lonB')">
                <span>åº¦åé€²åˆ¶</span>
                <button class="cb" onclick="clearCoord('lonB')">âœ–</button>
            </div>
            <div class="dmsr">
                <div class="dmsf"><input type="number" id="lonB_deg" placeholder="åº¦" oninput="dmsToD('lonB')"><span>åº¦</span></div>
                <div class="dmsf"><input type="number" id="lonB_min" placeholder="åˆ†" oninput="dmsToD('lonB')"><span>åˆ†</span></div>
                <div class="dmsf"><input type="number" id="lonB_sec" placeholder="ç§’" step="0.01" oninput="dmsToD('lonB')"><span>ç§’</span></div>
            </div>
        </div>
        
        <div class="er">
            <label for="eleB">é«˜åº¦ (Elevation)</label>
            <input type="number" id="eleB" placeholder="ç±³ (m)" step="0.01">
            <span>å…¬å°º (m)</span>
        </div>
    </div>

    <button id="calcBtn" onclick="calculate()">è¨ˆç®—ç›´ç·šè·é›¢ã€æ–¹ä½è§’èˆ‡ä¿¯ä»°è§’</button>

    <div id="res">
        é»æ“Šã€Œè¨ˆç®—ç›´ç·šè·é›¢ã€æ–¹ä½è§’èˆ‡ä¿¯ä»°è§’ã€ä»¥é¡¯ç¤ºçµæœ
    </div>
</div>

<script>
    // --- ç°¡åŒ–å¸¸æ•¸èˆ‡è¼”åŠ©å‡½æ•¸ ---
    const R_KM = 6371;
    const tRad = a => a * (Math.PI / 180);
    const tDeg = r => r * (180 / Math.PI);

    // DD to DMS è½‰æ›
    const dToDMS = (id) => {
        const dd = parseFloat(document.getElementById(id).value);
        if (isNaN(dd) || document.getElementById(id).value.trim() === '') {
            ['deg', 'min', 'sec'].forEach(s => document.getElementById(id + '_' + s).value = '');
            return;
        }
        const absDD = Math.abs(dd);
        const deg = Math.floor(absDD);
        const min = Math.floor((absDD - deg) * 60);
        const sec = ((absDD - deg) * 3600 - min * 60).toFixed(2);
        
        document.getElementById(id + '_deg').value = (dd < 0 ? -deg : deg);
        document.getElementById(id + '_min').value = min;
        document.getElementById(id + '_sec').value = sec;
    };

    // DMS to DD è½‰æ›
    const dmsToD = (id) => {
        const d = parseFloat(document.getElementById(id + '_deg').value);
        const m = parseFloat(document.getElementById(id + '_min').value) || 0;
        const s = parseFloat(document.getElementById(id + '_sec').value) || 0;
        
        if (isNaN(d) && !m && !s) { document.getElementById(id).value = ''; return; }
        
        const sign = (d < 0) ? -1 : 1;
        const dd = sign * (Math.abs(d) + m / 60 + s / 3600);
        if (!isNaN(dd)) { document.getElementById(id).value = dd.toFixed(8); } else { document.getElementById(id).value = ''; }
    };
    
    // æ¸…é™¤å–®çµ„åº§æ¨™
    const clearCoord = (idPrefix) => {
        document.getElementById(idPrefix).value = '';
        ['deg', 'min', 'sec'].forEach(s => document.getElementById(idPrefix + '_' + s).value = '');
        const suffix = idPrefix.slice(-1);
        document.getElementById('ele' + suffix).value = '';
        document.getElementById('name' + suffix).value = '';
    };

    // --- GPS è¨ˆç®—æ ¸å¿ƒå‡½æ•¸ ---

    // Haversine è·é›¢ (çƒé¢æŠ•å½±è·é›¢, km)
    const hDist = (lat1, lon1, lat2, lon2) => {
        const [rLat1, rLat2, dLat, dLon] = [tRad(lat1), tRad(lat2), tRad(lat2 - lat1), tRad(lon2 - lon1)];
        const a = Math.sin(dLat / 2)**2 + Math.cos(rLat1) * Math.cos(rLat2) * Math.sin(dLon / 2)**2;
        return R_KM * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    };
    
    // 3D ç›´ç·šè·é›¢ (km)
    const straightDist = (hD, eleA, eleB) => {
        const dH = (eleB - eleA) / 1000;
        return Math.sqrt(hD * hD + dH * dH);
    };

    // æ–¹ä½è§’ (Bearing, 0-360Â°)
    const getBearing = (lat1, lon1, lat2, lon2) => {
        const [rL1, rL2, dLon] = [tRad(lat1), tRad(lat2), tRad(lon2 - lon1)];
        const y = Math.sin(dLon) * Math.cos(rL2);
        const x = Math.cos(rL1) * Math.sin(rL2) - Math.sin(rL1) * Math.cos(rL2) * Math.cos(dLon);
        return (tDeg(Math.atan2(y, x)) + 360) % 360;
    };
    
    // ä¿¯ä»°è§’ (Pitch Angle, åº¦)
    const getPitch = (distKm, eleA, eleB) => {
        if (distKm === 0) return { pitchAB: 0, pitchBA: 0 };
        const [hA, hB] = [eleA / 1000, eleB / 1000];
        const offset = distKm**2 / (2 * R_KM);
        
        const H_AB = (hB - hA) - offset;
        const pitchAB = tDeg(Math.atan2(H_AB, distKm));
        
        const H_BA = (hA - hB) - offset;
        const pitchBA = tDeg(Math.atan2(H_BA, distKm));

        return { pitchAB, pitchBA };
    };


    // --- ä¸»è¨ˆç®—å‡½æ•¸ ---
    function calculate() {
        const [latA, lonA, latB, lonB, eleA, eleB] = 
            ['latA', 'lonA', 'latB', 'lonB', 'eleA', 'eleB'].map(id => parseFloat(document.getElementById(id).value || 0));
        
        const [nameA, nameB] = 
            ['nameA', 'nameB'].map(id => document.getElementById(id).value || (id === 'nameA' ? 'A' : 'B'));

        const resDiv = document.getElementById('res');

        if (isNaN(latA) || isNaN(lonA) || isNaN(latB) || isNaN(lonB)) {
            resDiv.innerHTML = "âŒ **è«‹è¼¸å…¥æœ‰æ•ˆçš„ GPS åº§æ¨™æ•¸å­—**";
            resDiv.style.borderColor = '#dc3545';
            resDiv.style.backgroundColor = '#f8d7da';
            return;
        }

        const hD = hDist(latA, lonA, latB, lonB);
        const sD = straightDist(hD, eleA, eleB);
        const bAB = getBearing(latA, lonA, latB, lonB);
        const bBA = getBearing(latB, lonB, latA, lonA); 
        const pitch = getPitch(hD, eleA, eleB);
        
        // æ ¼å¼åŒ–è·é›¢ (ä½¿ç”¨è—è‰² v-dist)
        const fDist = sD < 1 
            ? `<strong class="v-dist">${(sD * 1000).toFixed(2)}</strong> å…¬å°º`
            : `<strong class="v-dist">${sD.toFixed(2)}</strong> å…¬é‡Œ`;
        
        // é¡¯ç¤ºçµæœ
        resDiv.innerHTML = `
            <p>âœ… **å…©é»é–“çš„ç›´ç·šè·é›¢**ï¼š${fDist}</p>
            <hr>
            <p>ğŸ§­ **å¾ ${nameA} åˆ° ${nameB} çš„æ–¹ä½è§’**ï¼š<strong class="v-bearing">${bAB.toFixed(2)}Â°</strong></p>
            <p>â†©ï¸ **å¾ ${nameB} åˆ° ${nameA} çš„æ–¹ä½è§’**ï¼š<strong class="v-bearing">${bBA.toFixed(2)}Â°</strong></p>
            <hr style="border: 0; border-top: 1px dashed #ccc; margin: 2px 0;">
            <p class="rp">â« **${nameA} å° ${nameB} çš„ä¿¯ä»°è§’**ï¼š<strong style="color: #9c27b0;">${pitch.pitchAB.toFixed(2)}Â°</strong></p>
            <p class="rpn">(æ­£å€¼å‘ä¸Šä»°æœ›ï¼Œè² å€¼å‘ä¸‹ä¿¯è¦–)</p>
            <p class="rp">â¬ **${nameB} å° ${nameA} çš„ä¿¯ä»°è§’**ï¼š<strong style="color: #9c27b0;">${pitch.pitchBA.toFixed(2)}Â°</strong></p>
            <p class="rpn">(æ­£å€¼å‘ä¸Šä»°æœ›ï¼Œè² å€¼å‘ä¸‹ä¿¯è¦–)</p>
        `;
        resDiv.style.borderColor = '#007bff';
        resDiv.style.backgroundColor = '#e9f7ff';
    }
    
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
        // é è¨­å€¼
        document.getElementById('latA').value = '23.123456'; 
        document.getElementById('lonA').value = '122.654321'; 
        document.getElementById('eleA').value = '50'; 
        document.getElementById('nameA').value = 'æ³°å±±å£“é ‚'; 
        document.getElementById('latB').value = '24.123456'; 
        document.getElementById('lonB').value = '121.654321'; 
        document.getElementById('eleB').value = '2000'; 
        document.getElementById('nameB').value = 'å…‰æ˜é ‚'; 
        
        dToDMS('latA'); dToDMS('lonA'); dToDMS('latB'); dToDMS('lonB');
        calculate();
    });
</script>

</body>
</html>


